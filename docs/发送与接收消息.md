# 记录开发此功能过程中的一些进展和感悟

1. 发送消息给对方，首先要订阅对方状态，否则发送消息会报错，似乎是`mg`中`subscribe`不存在
2. 156 的userid是1816528707   151 是 2281402093

## 发送与响应的消息格式
* 发送消息   `lib/protocol/sdkws/sdkws.proto  MsgData`
* server 推送的消息格式  `lib/protocol/sdkws/sdkws.proto PushMessages`

golang 推送的消息，data 是protobuf 编码的字节串，由于我改造为json编码， 这里要用base64解码下

```agsl
options: {offlinePush : false} 
  options: {reactionFromCache : false} 
  options: {notPrivate : false} 
  options: {isNotNotification : false} 
  options: {isSendMsg : false} 
  options: {persistent : false} 
  options: {unreadCount : false} 
  options: {history : false} 
  options: {senderConversationUpdate : false} 
  options: {senderNotificationPush : false} 
  options: {conversationUpdate : false} 
  options: {senderSync : false} 
```

## 会话与消息机制
store中存储本地会话，保存在userid的box中。
box[conversations][conversationID] = conversation
box[messages][conversationID] = [message1, message2, ...]



